<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¡€æŸ“é˜æ¨“</title>
  <style>
    body { font-family: Arial; max-width: 900px; margin: auto; padding: 2em; }
    textarea, input[type='number'] { width: 100%; margin-bottom: 1em; padding: 0.5em; }
    button { padding: 0.5em 1em; margin: 1em 0; }
    .role-option { display: flex; align-items: center; margin-bottom: 4px; }
    .role-option input[type='checkbox'] { margin-right: 5px; }
    .view { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: center; }
    .townsfolk { background-color: #d4ebf2; }
    .outsider { background-color: #fff4cc; }
    .evil { background-color: #f9d1d1; }
    body { font-family: Arial; max-width: 900px; margin: auto; padding: 2em; }
    textarea, input[type='number'] { width: 100%; margin-bottom: 1em; padding: 0.5em; }
    button { padding: 0.5em 1em; margin: 1em 0; }
    .role-option {
        display: grid;
        grid-template-columns: 1fr auto auto auto;
        align-items: center;
        gap: 0.5em;
        margin-bottom: 4px;
        white-space: nowrap;
        }
    .role-name.townsfolk { color: #0074D9; font-weight: bold; }
    .role-name.outsider { color: #FFB800; font-weight: bold; }
    .role-name.evil { color: #D10000; font-weight: bold; }
    .role-option input[type='checkbox'] { margin-right: 5px; }
    .role-list-container {
        display: flex;
        gap: 1em;
        margin-bottom: 1em;
        justify-content: space-between;
        }
        
        
    .category-column {
        flex: 1;
        min-width: 280px;
        border: 1px solid #ccc;
        padding: 1em;
    }
    .category-column h4 { margin-top: 0; }
    .view { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: center; }
    .townsfolk { background-color: #d4ebf2; }
    .outsider { background-color: #fff4cc; }
    .evil { background-color: #f9d1d1; }
  </style>
</head>
<body>
  <h1>ğŸ©¸ è¡€æŸ“é˜æ¨“ MC è§’è‰²æŠ½å–åŠåˆ†é… Generator</h1>

  <h3>ğŸ”¢ ç©å®¶æ•¸ç›®</h3>
  <input type="number" id="playerCount" min="1" value="6" />

  <h3>ğŸ‘¥ ç©å®¶åç¨± (æ¯è¡Œä¸€å€‹)</h3>
  <textarea id="players" placeholder="Enter one player per line"></textarea>

  <h3>ğŸ­ è§’è‰²</h3>
  <div class="role-list-container" id="role-list"></div>

  <button onclick="generate()">ğŸ”€ Draw Roles & Assign Seats</button>
  <br>
  <label><input type="radio" name="view" value="mc" checked onchange="switchView()"> MC View (with roles)</label>
  <label><input type="radio" name="view" value="player" onchange="switchView()"> Player View (no roles)</label>

  <div id="mc-view" class="view">
    <h2>ğŸ“‹ MC View</h2>
    <table>
      <thead><tr><th>Seat</th><th>Player</th><th>Role</th></tr></thead>
      <tbody id="mc-table"></tbody>
      <div id="bluff-box" style="margin-top:12px;"></div>

    </table>
  </div>

  <div id="player-view" class="view">
    <h2>ğŸª‘ Player View</h2>
    <table>
      <thead><tr><th>Seat</th><th>Player</th></tr></thead>
      <tbody id="player-table"></tbody>
    </table>
  </div>

<script>
// roles with their categories
// roles with their categories + roleType
const roles = [
  // ğŸ‘‡ å£äººï¼šçˆªç‰™
  { name: "é–“è«œ",       category: "evil", roleType: "minion" },
  { name: "æŠ•æ¯’è€…",     category: "evil", roleType: "minion" },
  { name: "ç´…å”‡å¥³éƒ(è•©å©¦)", category: "evil", roleType: "minion" },
  { name: "ç”·çˆµ",       category: "evil", roleType: "minion" },

  // ğŸ‘‡ å£äººï¼šæƒ¡é­”
  { name: "å°æƒ¡é­”",     category: "evil", roleType: "demon" },

  // ğŸ‘‡ å¤–ä¾†è€… (outsider)
  { name: "è–å¾’", category: "outsider", roleType: "outsider" },
  { name: "éš±å£«", category: "outsider", roleType: "outsider" },
  { name: "ç®¡å®¶", category: "outsider", roleType: "outsider" },
  { name: "é…’é¬¼", category: "outsider", roleType: "outsider", isDrunk: true },

  // ğŸ‘‡ é®æ°‘ (townsfolk)
  { name: "æ´—è¡£å©¦",     category: "townsfolk", roleType: "townsfolk" },
  { name: "åœ–æ›¸ç®¡ç†å“¡", category: "townsfolk", roleType: "townsfolk" },
  { name: "èª¿æŸ¥å“¡",     category: "townsfolk", roleType: "townsfolk" },
  { name: "å»šå¸«",       category: "townsfolk", roleType: "townsfolk" },
  { name: "å…±æƒ…è€…",     category: "townsfolk", roleType: "townsfolk" },
  { name: "å åœå¸«",     category: "townsfolk", roleType: "townsfolk" },
  { name: "é€è‘¬è€…",     category: "townsfolk", roleType: "townsfolk" },
  { name: "åƒ§ä¾¶",       category: "townsfolk", roleType: "townsfolk" },
  { name: "æ¸¡é´‰å®ˆçœ‹è€…", category: "townsfolk", roleType: "townsfolk" },
  { name: "ç«¥è²ä¹‹äºº",   category: "townsfolk", roleType: "townsfolk" },
  { name: "æ®ºæ‰‹",       category: "townsfolk", roleType: "townsfolk" },
  { name: "å£«å…µ",       category: "townsfolk", roleType: "townsfolk" },
  { name: "å¸‚é•·",       category: "townsfolk", roleType: "townsfolk" }
];



window.onload = () => {
    const roleList = document.getElementById("role-list");
    const grouped = {
      townsfolk: roles.filter(r => r.category === "townsfolk"),
      outsider: roles.filter(r => r.category === "outsider"),
      evil: roles.filter(r => r.category === "evil")
    };
  
    const labels = {
      townsfolk: "ğŸŸ¦ é®æ°‘è§’è‰²",
      outsider: "ğŸŸ¨ å¤–ä¾†è€…è§’è‰²",
      evil: "ğŸŸ¥ å£äººè§’è‰²ï¼ˆçˆªç‰™/æƒ¡é­”)"
    };
  
    Object.keys(grouped).forEach(cat => {
      const col = document.createElement("div");
      col.className = "category-column";
      col.innerHTML = `<h4>${labels[cat]}</h4>`;
  
      grouped[cat].forEach(role => {
        const div = document.createElement("div");
        div.className = "role-option";
      
        if (role.name === "å°æƒ¡é­”") {
          div.innerHTML = `<span class="role-name ${role.category}">${role.name}ï¼ˆå¿…å®šæœ‰ï¼‰</span>`;
        } else {
          div.innerHTML = `
            <span class="role-name ${role.category}">${role.name}</span>
            <div class="checkbox-row">
                <input type="checkbox" class="force-role" /> <label>âœ… è¦æœ‰</label>
            </div>
            <div class="checkbox-row">
                <input type="checkbox" class="ban-role" /> <label>ğŸš« å””ç©</label>
            </div>
          `;
        }
      
        div.dataset.role = role.name;
        div.dataset.category = role.category;
        col.appendChild(div);
      });
      
      roleList.appendChild(col);
    });
  };
  
  function generate() {
    const quotas = {
      5:  { townsfolk: 3, outsider: 0, minion: 1, demon: 1 },
      6:  { townsfolk: 3, outsider: 1, minion: 1, demon: 1 },
      7:  { townsfolk: 5, outsider: 0, minion: 1, demon: 1 },
      8:  { townsfolk: 5, outsider: 1, minion: 1, demon: 1 },
      9:  { townsfolk: 5, outsider: 2, minion: 1, demon: 1 },
      10: { townsfolk: 7, outsider: 0, minion: 2, demon: 1 },
      11: { townsfolk: 7, outsider: 1, minion: 2, demon: 1 },
      12: { townsfolk: 7, outsider: 2, minion: 2, demon: 1 },
      13: { townsfolk: 9, outsider: 0, minion: 3, demon: 1 },
      14: { townsfolk: 9, outsider: 1, minion: 3, demon: 1 },
      15: { townsfolk: 9, outsider: 2, minion: 3, demon: 1 }
    };
  
    const playerCount = parseInt(document.getElementById("playerCount").value, 10);
    const target = quotas[playerCount];
    if (!target) { alert("ç›®å‰æ¯”ä¾‹åªæ”¯æ´ 5â€“15 ä½ç©å®¶ã€‚"); return; }
  
    // ç©å®¶åï¼šå…ˆæ´—ç‰Œå†æ´¾ä½ï¼ˆæ¯æ¬¡åº§ä½æ¬¡åºéƒ½æœƒä¸åŒï¼‰
    let playerList = document.getElementById('players').value
      .trim().split('\n').map(s => s.trim()).filter(Boolean);
    if (playerList.length === 0) {
      playerList = Array.from({ length: playerCount }, (_, i) => `Player ${i + 1}`);
    }
    if (playerList.length !== playerCount) {
      alert("ç©å®¶æ•¸ç›®åŒåå­—æ•¸é‡å””ä¸€è‡´ã€‚");
      return;
    }
    const shuffledPlayers = [...playerList];
    for (let i = shuffledPlayers.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffledPlayers[i], shuffledPlayers[j]] = [shuffledPlayers[j], shuffledPlayers[i]];
    }
  
    // è®€å–å‹¾é¸
    const forced = [];
    const banned = new Set();
    const pool   = [];
    document.querySelectorAll("#role-list .role-option").forEach(div => {
      const roleName = div.dataset.role;
      const cat      = div.dataset.category;
      const forceEl = div.querySelector(".force-role");
      const banEl   = div.querySelector(".ban-role");
      const must = forceEl ? forceEl.checked : false;
      const ban  = banEl   ? banEl.checked   : false;
      const obj = roles.find(r => r.name === roleName) || { name: roleName, category: cat };
  
      if (ban) banned.add(roleName);
      else if (must) forced.push(obj);
      else pool.push(obj);
    });
  
    // ä»¥ roleType åˆ†çµ„
    const byType = { townsfolk: [], outsider: [], minion: [], demon: [] };
    pool.forEach(r => { if (!banned.has(r.name)) byType[r.roleType].push(r); });
  
    const forcedByType = { townsfolk: 0, outsider: 0, minion: 0, demon: 0 };
    forced.forEach(r => forcedByType[r.roleType]++);
  
    for (const k of Object.keys(target)) {
      if (forcedByType[k] > target[k]) {
        alert(`ã€Œè¦æœ‰ã€è¶…å‡ºé…é¡ï¼š${k} éœ€è¦ ${target[k]}ï¼Œä½†ä½ å·²å¼·åˆ¶ ${forcedByType[k]}`);
        return;
      }
    }
    if (target.demon !== 1) { alert("å…§ç½®è¦å‰‡è¦æ±‚ Demon ä¸€å®šä¿‚ 1ã€‚"); return; }
  
    const takeRandom = (arr, n) => {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a.slice(0, n);
    };
  
    const chosen = [...forced];
  
    // éœ€æ±‚
    const need = {
      townsfolk: target.townsfolk - forcedByType.townsfolk,
      outsider:  target.outsider  - forcedByType.outsider,
      minion:    target.minion    - forcedByType.minion,
      demon:     target.demon     - forcedByType.demon
    };
  
    // å…ˆæŠ½ Demon/Minion/Outsider
    if (byType.minion.length < need.minion)   { alert("çˆªç‰™è§’è‰²æ± ä¸è¶³ã€‚"); return; }
    if (byType.outsider.length < need.outsider){ alert("å¤–ä¾†è€…è§’è‰²æ± ä¸è¶³ã€‚"); return; }
    if (byType.demon.length   < need.demon)   { alert("æƒ¡é­”è§’è‰²æ± ä¸è¶³ã€‚"); return; }
  
    const chosenMinions   = takeRandom(byType.minion,  need.minion);
    const chosenDemon     = takeRandom(byType.demon,   need.demon);
    const chosenOutsiders = takeRandom(byType.outsider,need.outsider);
  
    chosen.push(...chosenMinions, ...chosenDemon, ...chosenOutsiders);
  
    // æœ‰å†‡é…’é¬¼ï¼Ÿ
    const drunkChosen = chosen.some(r => r.isDrunk);
  
    // é®æ°‘ã€Œç…§æŠ½é½Šã€ target æ•¸é‡ï¼ˆå””å¥½ -1ï¼‰
    if (byType.townsfolk.length < need.townsfolk) { alert("é®æ°‘è§’è‰²æ± ä¸è¶³ã€‚"); return; }
    const chosenTownsf = takeRandom(byType.townsfolk, need.townsfolk);
    chosen.push(...chosenTownsf);
  
    // å¦‚æœæœ‰é…’é¬¼ï¼šå†é¡å¤–å¾ã€Œæœªç”¨å˜…é®æ°‘ã€æ”ä¸€å€‹åšæ®¼
    let drunkCover = null;
    if (drunkChosen) {
      const usedTownsf = new Set(chosenTownsf.map(r => r.name));
      forced.forEach(r => { if (r.roleType === "townsfolk") usedTownsf.add(r.name); });
      const remainingTownsf = byType.townsfolk.filter(r => !usedTownsf.has(r.name));
      if (remainingTownsf.length === 0) { alert("å†‡å¤šé¤˜å˜…é®æ°‘å¯ä»¥ç•€é…’é¬¼åšæ®¼ã€‚"); return; }
      drunkCover = takeRandom(remainingTownsf, 1)[0];
  
      // æ”¹é…’é¬¼é¡¯ç¤ºï¼šå¦‚ã€Œå åœå¸«(é…’é¬¼)ã€
      for (let i = 0; i < chosen.length; i++) {
        if (chosen[i].isDrunk) {
          chosen[i] = { name: `${drunkCover.name}(é…’é¬¼)`, category: "outsider", roleType: "outsider" };
          break;
        }
      }
    }
  
    // ç¸½æ•¸æ‡‰è©²ç­‰æ–¼ç©å®¶æ•¸
    if (chosen.length !== playerCount) {
      alert(`æŠ½å–æ•¸é‡(${chosen.length}) â‰  ç©å®¶æ•¸(${playerCount})ï¼Œè«‹æª¢æŸ¥è¨­å®šã€‚`);
      return;
    }
  
    // è§’è‰²æ´—ç‰Œï¼Œé…å°å·²æ´—ç‰Œå˜…ç©å®¶
    const shuffledRoles = takeRandom(chosen, chosen.length);
    const assignments = shuffledPlayers.map((name, i) => ({
      seat: i + 1,
      name,
      role: shuffledRoles[i].name,
      category: shuffledRoles[i].category
    }));
  
    // Render
    document.getElementById("mc-table").innerHTML = assignments
      .map(p => `<tr class="${p.category}"><td>${p.seat}</td><td>${p.name}</td><td>${p.role}</td></tr>`)
      .join('');
    document.getElementById("player-table").innerHTML = assignments
      .map(p => `<tr><td>${p.seat}</td><td>${p.name}</td></tr>`)
      .join('');
  
    // å°æƒ¡é­”å¯é¸ 3 å€‹é®æ°‘ bluffï¼ˆæ’é™¤å·²ç”¨ + é…’é¬¼æ®¼ + è¢« banï¼‰
    const usedTownsfNames = new Set(chosenTownsf.map(r => r.name));
    forced.forEach(r => { if (r.roleType === "townsfolk") usedTownsfNames.add(r.name); });
    if (drunkCover) usedTownsfNames.add(drunkCover.name);
  
    const allTownsf = roles.filter(r => r.roleType === "townsfolk")
                           .filter(r => !usedTownsfNames.has(r.name));
    const bluffs = takeRandom(allTownsf, Math.min(3, allTownsf.length)).map(r => r.name);
    document.getElementById("bluff-box").innerHTML =
      `<strong>å°æƒ¡é­”å¯é¸é®æ°‘ï¼ˆ3 é¸ï¼‰ï¼š</strong> ${bluffs.join("ã€")}`;
  
    switchView();
  }
  
  
  
  
  function switchView() {
    const view = document.querySelector('input[name="view"]:checked').value;
    document.getElementById("mc-view").style.display = view === "mc" ? "block" : "none";
    document.getElementById("player-view").style.display = view === "player" ? "block" : "none";
  }

</script>
</body>
</html>
